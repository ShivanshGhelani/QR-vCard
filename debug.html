<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Photo Upload</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-info { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .photo-preview { width: 100px; height: 100px; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 10px 0; }
        .photo-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Debug Photo Upload</h1>
    
    <div class="debug-info">
        <h3>Debug Information:</h3>
        <div id="debugInfo"></div>
    </div>
    
    <div>
        <h3>Photo Upload Test:</h3>
        <div id="photoPreview" class="photo-preview">
            <span>No Photo</span>
        </div>
        
        <input type="file" id="photo" accept="image/*" style="display: none;">
        
        <button onclick="document.getElementById('photo').click()">Choose Photo (Direct)</button>
        <button onclick="testPhotoUpload()">Choose Photo (Function)</button>
        <button onclick="removePhoto()">Remove Photo</button>
        
        <div>
            <input type="file" id="photoVisible" accept="image/*" style="display: block;">
            <label>â†‘ Visible file input for comparison</label>
        </div>
    </div>
    
    <script>
        let currentPhotoData = null;
        
        function log(message) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }
        
        function testPhotoUpload() {
            log('testPhotoUpload() called');
            const photoInput = document.getElementById('photo');
            log('Photo input found: ' + (photoInput ? 'Yes' : 'No'));
            if (photoInput) {
                log('Triggering click on hidden input');
                photoInput.click();
            }
        }
        
        function handlePhotoUpload(event) {
            log('handlePhotoUpload() called');
            const file = event.target.files[0];
            if (!file) {
                log('No file selected');
                return;
            }
            
            log('File selected: ' + file.name + ' (' + file.type + ', ' + file.size + ' bytes)');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                log('File loaded successfully');
                const photoPreview = document.getElementById('photoPreview');
                photoPreview.innerHTML = '<img src="' + e.target.result + '" alt="Photo">';
                currentPhotoData = e.target.result;
            };
            reader.onerror = () => {
                log('Error reading file');
            };
            reader.readAsDataURL(file);
        }
        
        function removePhoto() {
            log('removePhoto() called');
            const photoPreview = document.getElementById('photoPreview');
            photoPreview.innerHTML = '<span>No Photo</span>';
            document.getElementById('photo').value = '';
            document.getElementById('photoVisible').value = '';
            currentPhotoData = null;
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            log('DOM loaded');
            
            // Test if elements exist
            const photo = document.getElementById('photo');
            const photoPreview = document.getElementById('photoPreview');
            
            log('Photo input exists: ' + (photo ? 'Yes' : 'No'));
            log('Photo preview exists: ' + (photoPreview ? 'Yes' : 'No'));
            
            // Bind events
            if (photo) {
                photo.addEventListener('change', handlePhotoUpload);
                log('Event listener added to hidden input');
            }
            
            const photoVisible = document.getElementById('photoVisible');
            if (photoVisible) {
                photoVisible.addEventListener('change', handlePhotoUpload);
                log('Event listener added to visible input');
            }
            
            // Test clicking photo preview
            if (photoPreview) {
                photoPreview.addEventListener('click', () => {
                    log('Photo preview clicked');
                    if (photo) {
                        photo.click();
                    }
                });
                photoPreview.style.cursor = 'pointer';
            }
        });
    </script>
</body>
</html>
